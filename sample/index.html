<!DOCTYPE html>
<html>
<head>
  <title>Sample jq-AutoComplete</title>
  <script type="text/javascript" src="jquery/jquery.js"></script>
  <script type="text/javascript" src="jq-autocomplete/src/jq-autocomplete.js"></script>
  <script type="text/javascript" src="jq-phototagging.js"></script>

  <link rel="stylesheet" href="bootstrap.css/css/bootstrap.css"/>
  <link rel="stylesheet" href="jq-autocomplete/src/jq-autocomplete.css"/>
  <link rel="stylesheet" href="jq-phototagging.css"/>

  <style>
    .pic-tags:after {
      content: ".";
      visibility: hidden;
      display: block;
      height: 0;
      clear: both;
    }

    .pic {
      float: left;
    }

    .tags {
      float: left;
    }
  </style>
</head>
<body>

<div class="pic-tags">
  <div class="pic">
    <img id="img-1" src="sample.jpg"/>
  </div>
  <ul id="tags-1" class="tags"></ul>
</div>
<div class="license">
  <p>Image from Arno Meintjes.</p>
  <p>License: Creative Commons</p>
  <p>Original: http://www.flickr.com/photos/arnolouise/8330315868/sizes/c/in/pool-809956@N25/</p>
</div>

<div class="pic-tags">
  <div class="pic">
    <img id="img-2" src="sample2.jpg"/>
  </div>
  <ul id="tags-2" class="tags"></ul>
</div>
<div class="license">
  <p>Image from Thomas Bresson.</p>
  <p>License: Creative Commons</p>
  <p>Original: http://www.flickr.com/photos/computerhotline/2213940521/sizes/z/in/pool-574803@N20/</p>
</div>

<form class="create-form" action="/species" method="POST">
  <label>Name :</label>
  <input type="text" name="name" placeholder="Name" />
</form>

<script type="text/javascript">
  var tag1 = {
    id: 1,
    name: 'First Tag',
    imgWidth: 800,
    imgHeight: 534,
    x: 500,
    y: 200,
    width: 250,
    height: 300
  };

  var tag2 = {
    id: 2,
    name: 'Second Tag',
    imgWidth: 800,
    imgHeight: 534,
    x: 150,
    y: 150,
    width: 250,
    height: 215
  };

  var $tagging1;
  var $tagging2;

  var $createForm = $('.create-form').eq(0);

  var currentSpecies = null;

  var autocomplete = function($wrapper, $input) {
    $input.jqAutoComplete({
      url: '/species',
      relativeTo: $wrapper,
      label: 'name',
      $createForm: $createForm,
      select: function(species) {
        currentSpecies = species;
      },
      unSelect: function() {
        currentSpecies = null;
      },
      onSavedSuccess: function(species) {
        currentSpecies = species;
        $tagging1.submit({
          name: species.name,
          species: species
        });
      }
    });
  };

  $tagging1 = $('#img-1').jqPhotoTagging({
    url: '/tags',
    $tags: '#tags-1',
    tags: [tag1, tag2],
    width: 100,
    height: 100,
    onInitialized: function($wrapper, $form) {
      var $input = $form.find('input');
      autocomplete($wrapper, $input);
    },
    isValid: function() {
      return !!currentSpecies;
    },
    onSavedSuccess: function() {
      currentSpecies = null;
    }
  });

  var tag3 = {
    id: 1,
    name: 'Third Tag',
    imgWidth: 800,
    imgHeight: 534,
    x: 500,
    y: 200,
    width: 250,
    height: 300
  };

  var tag4 = {
    id: 2,
    name: 'Fourth Tag',
    imgWidth: 800,
    imgHeight: 534,
    x: 150,
    y: 150,
    width: 250,
    height: 215
  };

  $tagging2 = $('#img-2').jqPhotoTagging({
    url: '/tags',
    $tags: '#tags-2',
    tags: [tag3, tag4],
    width: 100,
    height: 100
  });
</script>
</body>
</html>